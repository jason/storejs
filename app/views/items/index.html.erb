<h1>The AJAX Cart!! :D!!!</h1>

<div class="row">
  <div class = "eight columns">
  <ul>
  <% @items.each do |item| %>
    <li>Name: <%= item.name %></li>
    Price: $<%= item.price / 100 %>
    <br>
    <a href="#" class="add-item button round" data-item-id="<%=item.id%>">Add to Cart :D</a>
  <% end %>
  </ul>
</div>

<div class="cart four columns">
  <h2>Cart! :D :) :></h2>
  <ul class="cart-itemz">
  </ul>
</div>

</div>

<script type="text/javascript">
  $(function() {
    $('a').click(function() {
      item_id = parseInt($(this).attr('data-item-id'));

      $.post("cart_items.json", {
        cart_item: {
          item_id: item_id
        }
      }, function(response) {
        $.getJSON(
          "/cart_items.json",
          function(data){
            var total = 0;
            $('.cart-itemz').empty();
            $.each(data, function(i, datum) {
              var name = datum['item']['name'];
              var price = parseInt(datum['item']['price'])/100;
              var quantity = parseInt(datum['quantity']);
              var subtotal = price*quantity;
              total += subtotal;
              var itemId = datum['item_id'];

              $('.cart-itemz')
                      .append('<li data-item-id=' + itemId + '>' + name + '<br>'
                      + 'Price: $' + price + '<br>'
                      + 'Quantity: ' + quantity + '<br>'
                      + 'Subtotal: $' + subtotal + '</li>')
            })
            $('.cart-itemz').append('<br><br>Total: $' + total)
          }
        )
      })
    })


  })
</script>